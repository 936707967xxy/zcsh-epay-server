
===============================V1.0================================================
|version      |:V1.0
|Author       |:  |
|Modify time  |:  |
|Description  |: 

*******************************************1.0 ��e��*********************************************
用户表添加错误次数字段：
ALTER TABLE FR_MG_USER ADD COLUMN error_times int default 0; 

用户表修改passowrd字段为password 非空

remark 非空改为可空

FR_MG_USER_ROLE 表的create_time 类型修改为timestemp类型



--订单历史表重建
DROP TABLE DB2INST1.FR_ORDER_HIS 
GO
CREATE TABLE DB2INST1.FR_ORDER_HIS  ( 
	ID            	BIGINT NOT NULL,
	CREATE_TIME   	TIMESTAMP NOT NULL,
	UPDATE_TIME   	TIMESTAMP,
	ORDER_ID      	VARCHAR(32) NOT NULL,
	PAYMENT_ID    	VARCHAR(32),
	THIRD_ORDER_ID	VARCHAR(32),
	TRADE_ID      	VARCHAR(32),
	TRADE_NO      	VARCHAR(32),
	SOURCE_CHANNEL	CHARACTER(2) NOT NULL,
	TYPE          	CHARACTER(2) NOT NULL,
	PRO_ORG_CODE  	VARCHAR(32) NOT NULL,
	CITY_ORG_CODE 	VARCHAR(32) NOT NULL,
	ORG_CODE      	VARCHAR(32) NOT NULL,
	MERCHANT_ID   	VARCHAR(32) NOT NULL,
	OUTLET_ID     	VARCHAR(32) NOT NULL,
	USER_ID       	VARCHAR(32),
	TOTAL_MONEY   	DECIMAL(16,3) NOT NULL,
	CASH_MONEY    	DECIMAL(16,3) NOT NULL,
	POINT         	DECIMAL(16,3) NOT NULL,
	ORDER_STATUS  	CHARACTER(1) NOT NULL,
	ORDER_STATE   	CHARACTER(1) NOT NULL,
	ORDER_DISPLAY 	CLOB(65536) LOGGED NOT COMPACT,
	SUCCESS_TIME  	TIMESTAMP,
	EXPIRE_TIME   	TIMESTAMP,
    SUCCESS_CODE  	CHARACTER(4),
	BAK1          	VARCHAR(256),
	BAK2          	VARCHAR(256),
	BAK3          	VARCHAR(256),
	BAK4          	VARCHAR(256),
	BAK5          	VARCHAR(256),
	BAK6          	VARCHAR(256),
	CONSTRAINT P_Key_1 PRIMARY KEY(ID)
)
GO
COMMENT ON TABLE DB2INST1.FR_ORDER_HIS IS '3个月以前的数据转移到历史表'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.ORDER_ID IS '订单编号'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.PAYMENT_ID IS '支付网关受理支付返回账单编号'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.THIRD_ORDER_ID IS '收款银行渠道订单号'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.TRADE_ID IS '第三方预付单号'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.TRADE_NO IS '收单机构交易单号
第三方交易流水号，支付成功后返回'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.SOURCE_CHANNEL IS '扫码来源渠道
00-微信
01-支付宝
02-社区e银行'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.TYPE IS '交易方式
00-C扫B
01-B扫C'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.PRO_ORG_CODE IS '省级编码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.CITY_ORG_CODE IS '法人行编码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.ORG_CODE IS '网点编码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.MERCHANT_ID IS '商户统一编码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.OUTLET_ID IS '门店编码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.USER_ID IS '用户编码
微信:opened
支付宝:buyer_id
社区银行:membercode'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.TOTAL_MONEY IS '订单金额'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.CASH_MONEY IS '现金支付金额'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.POINT IS '积分支付金额'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.ORDER_STATUS IS '订单状态
1:"待支付"
2:"支付中"
3:"交易成功"
4:"交易失败"
5:"交易关闭"
6."交易成功有退款"'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.ORDER_DISPLAY IS '展示在第三方订单描述'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.SUCCESS_TIME IS '支付成功时间'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.EXPIRE_TIME IS '订单超时时间'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.SUCCESS_CODE IS '支付成功码'
GO
COMMENT ON COLUMN DB2INST1.FR_ORDER_HIS.BAK1 IS '备用字段'
GO

--积分对账文件数据表字段修改
ALTER TABLE FR_BANK_POINT_DZ ALTER BANK_SEQ SET DATA TYPE VARCHAR(32)
GO
ALTER TABLE FR_BANK_POINT_DZ ALTER BANK_TIME SET DATA TYPE TIMESTAMP
GO
ALTER TABLE FR_BANK_POINT_DZ ALTER USER_ID SET DATA TYPE VARCHAR(80)
GO
ALTER TABLE FR_BANK_POINT_DZ ALTER TRAN_TYPE SET DATA TYPE VARCHAR(10)
GO
ALTER TABLE FR_BANK_POINT_DZ ALTER TRAN_POINT SET DATA TYPE DECIMAL(15,3)
GO

FR_MG_LOG 表添加IP字段；与FR_MG_LOG_HIS保持一致


CREATE TABLE DB2INST1.FR_SEQ_INFO (
	PK1 VARCHAR(40) NOT NULL, 
	SEQ_TYPE VARCHAR(40) NOT NULL, 
	SEQ_DATE VARCHAR(20) NOT NULL, 
	SEQ_VALUE INTEGER NOT NULL, 
	MEMO1 VARCHAR(40), 
	MEMO2 VARCHAR(40), 
	MEMO3 VARCHAR(40), 
	CONSTRAINT P_PK_FR_SEQ_INFO PRIMARY KEY (PK1), 
	CONSTRAINT UK_FR_SEQ_INFO UNIQUE (SEQ_TYPE)
);
COMMENT ON TABLE DB2INST1.FR_SEQ_INFO IS '业务序列表';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.PK1 IS '主键';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.SEQ_TYPE IS '业务类型';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.SEQ_DATE IS '时期前缀';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.SEQ_VALUE IS '序号';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.MEMO1 IS '备用字段';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.MEMO2 IS '备用字段';
COMMENT ON COLUMN DB2INST1.FR_SEQ_INFO.MEMO3 IS '备用字段';

CREATE TABLE FR_THIRD_ACCESS_TOKEN (ID BIGINT NOT NULL, CHANNEL VARCHAR(2), APP_ID VARCHAR(100), ACCESS_TOKEN VARCHAR(256), ACCESS_TOKEN_EXPIRES_IN TIMESTAMP, ACCESS_TOKEN_UPDATE_TIME TIMESTAMP, TICKET VARCHAR(256), TICKET_EXPIRES_IN TIMESTAMP, TICKET_UPDATE_TIME TIMESTAMP,  CONSTRAINT P_Key_1 PRIMARY KEY (ID));
COMMENT ON TABLE FR_THIRD_ACCESS_TOKEN IS '第三方接口访问基础信息表';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.CHANNEL IS '渠道，支付宝：01，微信：00';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.APP_ID IS '开发者appId';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.ACCESS_TOKEN IS 'ACCESS_TOKEN';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.ACCESS_TOKEN_EXPIRES_IN IS 'ACCESS_TOKEN有效时间';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.ACCESS_TOKEN_UPDATE_TIME IS 'ACCESS_TOKEN更新时间';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.TICKET IS 'TICKET';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.TICKET_EXPIRES_IN IS '刷新令牌有效期';
COMMENT ON COLUMN FR_THIRD_ACCESS_TOKEN.TICKET_UPDATE_TIME IS 'TICKET更新时间';


CREATE TABLE FR_THIRD_AUTHCODE (ID BIGINT NOT NULL, AUTHCODE VARCHAR(128), USERID VARCHAR(256), ACCESS_TOKEN VARCHAR(256), CODE VARCHAR(50), CHANNEL VARCHAR(2), VALIDATE TIMESTAMP, UPDATE_TIME TIMESTAMP, REFRESH_TOKEN VARCHAR(256), CREATE_TIME TIMESTAMP,  CONSTRAINT P_Key_1 PRIMARY KEY (ID));
COMMENT ON TABLE FR_THIRD_AUTHCODE IS '授权认证表';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.AUTHCODE IS '授权认证前端COOKIE值';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.USERID IS '微信是OPENID';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.ACCESS_TOKEN IS 'access_token';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.CODE IS '用来换取OPENID和ACCESS_TOKE';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.CHANNEL IS '渠道：支付宝01，微信00';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.VALIDATE IS '失效时间';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.UPDATE_TIME IS '更新时间';
COMMENT ON COLUMN FR_THIRD_AUTHCODE.REFRESH_TOKEN IS '用来刷新token';

CREATE TABLE FR_THIRD_BANK_AUTHCODE (ID BIGINT NOT NULL, CHANNEL VARCHAR(2), APP_AUTH_TOKEN VARCHAR(100), USER_ID VARCHAR(20), CODE VARCHAR(50), EXPIRES_IN TIMESTAMP, RE_EXPIRES_IN TIMESTAMP, UPDATE_TIME TIMESTAMP, APP_REFRESH_TOKEN VARCHAR(256),  CONSTRAINT P_Key_1 PRIMARY KEY (ID));
COMMENT ON TABLE FR_THIRD_BANK_AUTHCODE IS '第三方应用授权表';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.CHANNEL IS '渠道，支付宝：01，微信：00';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.APP_AUTH_TOKEN IS '商户授权令牌';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.USER_ID IS '授权商户的ID';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.CODE IS '授权码：用来换取OPENID和ACCESS_TOKE';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.EXPIRES_IN IS '令牌有效期';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.RE_EXPIRES_IN IS '刷新令牌有效期';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.UPDATE_TIME IS '更新时间';
COMMENT ON COLUMN FR_THIRD_BANK_AUTHCODE.APP_REFRESH_TOKEN IS '刷新令牌时使用';


